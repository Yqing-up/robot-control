<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONé”™è¯¯æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .error {
            color: red;
            background: #ffe6e6;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
        }
        .success {
            color: green;
            background: #e6ffe6;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #console {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>JSONè§£æé”™è¯¯æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•åœºæ™¯</h3>
        <button onclick="testValidJson()">æµ‹è¯•æ­£å¸¸JSON</button>
        <button onclick="testInvalidJson()">æµ‹è¯•æ— æ•ˆJSON</button>
        <button onclick="testUnterminatedString()">æµ‹è¯•æœªç»ˆæ­¢å­—ç¬¦ä¸²</button>
        <button onclick="testImageAnalysis()">æµ‹è¯•å›¾ç‰‡åˆ†æAPI</button>
        <button onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
    </div>

    <div class="test-section">
        <h3>æ§åˆ¶å°è¾“å‡º</h3>
        <div id="console"></div>
    </div>

    <script type="module">
        import { analyzeImages } from './src/api/imageAnalysis.js'

        // é‡å®šå‘console.logåˆ°é¡µé¢
        const originalLog = console.log
        const originalError = console.error
        const originalWarn = console.warn
        const consoleDiv = document.getElementById('console')

        function addToConsole(type, ...args) {
            const timestamp = new Date().toLocaleTimeString()
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ')
            
            const div = document.createElement('div')
            div.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black'
            div.textContent = `[${timestamp}] ${type.toUpperCase()}: ${message}`
            consoleDiv.appendChild(div)
            consoleDiv.scrollTop = consoleDiv.scrollHeight
        }

        console.log = (...args) => {
            originalLog(...args)
            addToConsole('log', ...args)
        }

        console.error = (...args) => {
            originalError(...args)
            addToConsole('error', ...args)
        }

        console.warn = (...args) => {
            originalWarn(...args)
            addToConsole('warn', ...args)
        }

        // æµ‹è¯•å‡½æ•°
        window.testValidJson = function() {
            console.log('=== æµ‹è¯•æ­£å¸¸JSON ===')
            try {
                const validJson = '{"name": "test", "value": 123}'
                const result = JSON.parse(validJson)
                console.log('âœ… è§£ææˆåŠŸ:', result)
            } catch (error) {
                console.error('âŒ è§£æå¤±è´¥:', error.message)
            }
        }

        window.testInvalidJson = function() {
            console.log('=== æµ‹è¯•æ— æ•ˆJSON ===')
            try {
                const invalidJson = '{"name": "test", "value": 123'  // ç¼ºå°‘ç»“æŸæ‹¬å·
                const result = JSON.parse(invalidJson)
                console.log('âœ… è§£ææˆåŠŸ:', result)
            } catch (error) {
                console.error('âŒ è§£æå¤±è´¥:', error.message)
            }
        }

        window.testUnterminatedString = function() {
            console.log('=== æµ‹è¯•æœªç»ˆæ­¢å­—ç¬¦ä¸² ===')
            try {
                const unterminatedJson = '{"name": "test", "description": "è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æè¿°'  // ç¼ºå°‘å¼•å·å’Œæ‹¬å·
                const result = JSON.parse(unterminatedJson)
                console.log('âœ… è§£ææˆåŠŸ:', result)
            } catch (error) {
                console.error('âŒ è§£æå¤±è´¥:', error.message)
                if (error.message.includes('Unterminated string')) {
                    console.warn('âš ï¸ æ£€æµ‹åˆ°æœªç»ˆæ­¢çš„å­—ç¬¦ä¸²é”™è¯¯')
                }
            }
        }

        window.testImageAnalysis = async function() {
            console.log('=== æµ‹è¯•å›¾ç‰‡åˆ†æAPI ===')
            try {
                // åˆ›å»ºä¸€ä¸ªæµ‹è¯•å›¾ç‰‡æ–‡ä»¶
                const canvas = document.createElement('canvas')
                canvas.width = 100
                canvas.height = 100
                const ctx = canvas.getContext('2d')
                ctx.fillStyle = '#ff0000'
                ctx.fillRect(0, 0, 100, 100)
                
                canvas.toBlob(async (blob) => {
                    const file = new File([blob], 'test.png', { type: 'image/png' })
                    console.log('ğŸ“¸ åˆ›å»ºæµ‹è¯•å›¾ç‰‡æ–‡ä»¶:', file.name, file.size, 'bytes')
                    
                    try {
                        const result = await analyzeImages([file], 'è¿™æ˜¯ä»€ä¹ˆé¢œè‰²ï¼Ÿ')
                        console.log('âœ… åˆ†ææˆåŠŸ:', result)
                    } catch (error) {
                        console.error('âŒ åˆ†æå¤±è´¥:', error.message)
                    }
                })
            } catch (error) {
                console.error('âŒ æµ‹è¯•å¤±è´¥:', error.message)
            }
        }

        window.clearConsole = function() {
            consoleDiv.innerHTML = ''
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        console.log('ğŸš€ JSONé”™è¯¯æµ‹è¯•é¡µé¢å·²åŠ è½½')
        console.log('ğŸ’¡ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•ä¸åŒçš„JSONè§£æåœºæ™¯')
    </script>
</body>
</html>
